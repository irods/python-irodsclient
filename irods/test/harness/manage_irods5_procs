if [ "$1" = "start" ]; then
  sudo su - irods -c 'irodsServer -d -p /tmp/irods.pid'
elif [ "$1" = "start-bg" ]; then
  sudo su - irods -c 'irodsServer --stdout -p /tmp/irods.pid >/tmp/irods.log &'
elif [ "$1" = "status" ]; then
  pgrep -afl "irods(Delay|Agent|Server)"
elif [ "$1" = "stop" ]; then
  sudo su - irods -c 'kill -QUIT $(cat /tmp/irods.pid) && rm -f /tmp/irods.pid'
elif [ "$1" = "wait" ]; then
  sudo su - irods -c '
      pid=`cat /tmp/irods.pid 2>/dev/null`;
      [ -n "$pid" ] && { while ps -eo pid |grep $pid >/dev/null 2>&1; do sleep 1; done; }'
else
  echo >&2 "usage: $0 [start|status|stop]"
  exit 2
fi
